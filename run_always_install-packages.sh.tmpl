{{ if eq .chezmoi.os "darwin" -}}
#!/bin/bash
# Packages hash: {{ include ".chezmoidata/packages.yaml" | sha256sum }}

# Update Homebrew and all taps first
brew update
brew upgrade
brew upgrade --cask --greedy

# Install and upgrade all packages
brew bundle --file=/dev/stdin --cleanup <<EOF
{{ range .packages.universal.taps -}}
tap {{ . | quote | replace " " "\", \"" }}
{{ end -}}
{{ range .packages.universal.brews -}}
brew {{ . | quote }}
{{ end -}}
{{ range .packages.universal.casks -}}
cask {{ . | quote }}
{{ end -}}
{{ range .packages.universal.mas -}}
mas {{ .name | quote }}, id: {{ .id }}
{{ end -}}
EOF
brew cleanup && brew autoremove
{{ end -}}
